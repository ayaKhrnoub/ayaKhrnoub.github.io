import{P as h,r as s,h as v,n as N,j as e,O as C,o as O,p as T,q as I}from"./index-b1cdc86a.js";import{u as w}from"./useFetch-651c1fca.js";import{S as q}from"./Square-3af8b40d.js";const k=({userBooked:t,setShowModal:l,ticketPrice:i})=>{const[a,r]=s.useState(0),[c,f]=s.useState(""),{eventId:d}=v(),{token:n}=N();s.useState(!1);const[m,b]=s.useState(!1),x=()=>{b(!0);const u=t.map(o=>O.post(`${T}/api/party/book-place`,{number:o,party_id:d},{headers:{Authorization:`Bearer ${n}`}}));Promise.all(u).then(o=>{o.forEach(j=>{console.log(j.data)})}).catch(o=>{console.error(o)})};return s.useEffect(()=>{r(0)},[]),t.length===0?e.jsxs("div",{children:[e.jsx("p",{className:"text-center pb-6 pt-10 text-3xl",children:"Please choose a seat before continuing."}),e.jsx("div",{className:"flex justify-center mt-2 items-center",children:e.jsx("button",{onClick:()=>l(!1),className:"uppercase h-10 w-24 text-xl sm:text-2xl text-white rounded-lg bg-primary",children:"back"})})]}):a===0?e.jsxs(s.Fragment,{children:[e.jsx("div",{className:"w-1/2 mt-4 mx-auto",children:e.jsx("div",{className:"mx-auto my-8 capitalize relative",children:e.jsxs("div",{className:"w-full flex justify-between items-center mx-auto",children:[e.jsx(q,{}),e.jsxs("h3",{className:"font-bold uppercase text-3xl",children:[t.length," seats"]})]})})}),e.jsxs("div",{className:"w-full sm:w-10/12 mx-auto",children:[e.jsxs("p",{className:"text-2xl capitalize text-center font-semibold",children:["Seat price: ",i," S.P"]}),e.jsxs("p",{className:"text-2xl capitalize text-center font-semibold",children:["total price: ",i*t.length," S.P"]})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-2 items-center",children:[e.jsx("button",{onClick:()=>l(!1),className:"uppercase h-10 w-24 text-xl sm:text-2xl text-white rounded-lg bg-primary",children:"cancel"}),e.jsx("button",{onClick:()=>r(1),className:"uppercase h-10 w-24 text-xl sm:text-2xl text-white rounded-lg bg-purple",children:"pay"})]})]}):e.jsxs(s.Fragment,{children:[e.jsx("h3",{className:"text-center text-3xl capitalize font-semibold pt-4",children:"please enter code"}),e.jsx("p",{className:"text-center text-base capitalize text-gray-600 font-semibold pt-2",children:"We have sent you a verification code to your email. Please paste the code to verify"}),e.jsx("div",{className:"pt-2",children:e.jsx(C,{otp:c,setOtp:f,valueLength:4})}),e.jsx("div",{className:"flex justify-center items-center py-4",children:e.jsx("button",{onClick:x,className:"capitalize flex justify-center hover:bg-primary/80 duration-300 bg-primary rounded-lg text-2xl font-bold text-white items-center w-24 h-12 ",children:"sent"})})]})};k.propTypes={userBooked:h.arrayOf(h.number).isRequired,setShowModal:h.func.isRequired,ticketPrice:h.number.isRequired};function L(t,l){let i=[],a=0;for(l.forEach(r=>{i.push(t.slice(a,a+r)),a+=r});a<t.length;)i.push(t.slice(a,a+l[2])),a+=l[2];return i}const S=({userSeats:t,isLoggedIn:l})=>{const{eventId:i}=v(),[a,r]=s.useState([]),{user:c}=N(),[f,d]=s.useState(!1),[n,m]=s.useState([]),[b,x]=s.useState([]),{data:u,isLoading:o,error:j}=w(`/api/party/show/${i}`);return s.useEffect(()=>{Object.keys(c).length!==0?l||console.log("خالصة الجلسة"):console.log("مالو مسجل دخولو")},[c,l]),s.useEffect(()=>{m(t)},[t]),s.useEffect(()=>{x(n.filter(g=>!t.includes(g)))},[n,t]),s.useEffect(()=>{o||(j?console.log("navigate to 404"):r(L(JSON.parse(u.seats),[22,26,30])))},[u,o,j]),e.jsxs(s.Fragment,{children:[e.jsx("div",{className:"w-[95%] px-12 overflow-x-auto mx-auto",children:e.jsxs("div",{className:"min-w-[750px] sm:w-full mx-auto",children:[e.jsx("div",{style:{transform:"perspective(700px) rotateX(-70deg)"},className:"w-[95%] mx-auto h-28 bg-primary/80 relative"}),e.jsx("div",{className:`w-[88.5%] -translate-y-10 mx-auto h-20 relative bg-gradient-to-t\r
                 to-primary/30 from-transparent`}),a.map((g,P)=>e.jsx("div",{className:"flex w-full justify-center items-start mb-4 gap-1 md:gap-2",children:g.map((p,z)=>e.jsx("button",{onClick:()=>{if(!p.booked&&!(t.length>=c.allowed_tickets))if(n.includes(p.number))m(y=>y.filter(E=>E!==p.number));else{if(n.length>=c.allowed_tickets)return;m(y=>[...y,p.number])}},disabled:p.booked,className:`${n.includes(p.number)?"bg-purple":"bg-gray-500"} disabled:bg-primary hover:scale-110 duration-200 w-5 h-5 md:w-7 md:h-7 rounded-sm`,children:e.jsx("span",{className:"sr-only",children:`seats number ${p.number}`})},z))},P))]})}),e.jsx("div",{className:"flex justify-center mt-8 items-center",children:e.jsx("button",{onClick:()=>d(!0),className:"uppercase h-10 w-24 text-xl sm:text-2xl text-white rounded-lg bg-primary",children:"next"})}),e.jsx(I,{isOpen:f,onClose:d,clickOutSide:!0,children:e.jsx(k,{userBooked:b,setShowModal:d,ticketPrice:+(u==null?void 0:u.ticket_price)})})]})};S.propTypes={userSeats:h.arrayOf(h.number).isRequired,isLoggedIn:h.bool.isRequired};const F=()=>{const{data:t,isLoading:l,error:i,errorMessage:a}=w("/api/party/my-tickets"),[r,c]=s.useState([]),{eventId:f}=v(),[d,n]=s.useState(!0);return s.useEffect(()=>{var m,b;l||(i?typeof a!="string"&&((b=(m=a==null?void 0:a.response)==null?void 0:m.data)==null?void 0:b.message)==="Unauthenticated."&&n(!1):t!=null&&t.data&&c(t.data.filter(x=>+x.party_id==+f).map(x=>+x.booked_seat_number)))},[t,l,i,f,a]),s.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},[]),e.jsxs("div",{className:"mt-16 min-h-100vh px-5 py-5",children:[e.jsx("h2",{className:"text-center text-xl sm:text-2xl md:text-3xl font-bold capitalize",children:"select your seats"}),e.jsx("div",{className:"w-[95%] px-12 mt-8 overflow-x-auto mx-auto",children:e.jsxs("div",{className:"flex w-full justify-evenly items-start mb-4 gap-1 md:gap-2",children:[e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{className:"bg-gray-500 hover:scale-110 duration-200 w-5 h-5 md:w-7 md:h-7 rounded-sm",children:e.jsx("span",{className:"sr-only",children:"seat"})}),e.jsx("p",{className:"text-xl font-semibold capitalize",children:"available"})]}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{className:"bg-primary hover:scale-110 duration-200 w-5 h-5 md:w-7 md:h-7 rounded-sm",children:e.jsx("span",{className:"sr-only",children:"seat"})}),e.jsx("p",{className:"text-xl font-semibold capitalize",children:"sold"})]}),e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{className:"bg-purple hover:scale-110 duration-200 w-5 h-5 md:w-7 md:h-7 rounded-sm",children:e.jsx("span",{className:"sr-only",children:"seat"})}),e.jsx("p",{className:"text-xl font-semibold capitalize",children:"selected"})]})]})}),l?null:e.jsx(S,{userSeats:r,isLoggedIn:d})]})};export{F as default};
